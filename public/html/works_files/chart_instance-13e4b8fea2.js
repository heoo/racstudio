/*!***********************************************
 Copyright (c) 2019, Neusoft Inc.
 All rights reserved
 图表秀 Version 1.0.0 2020.4.24
 ************************************************/
"use strict";charting.factory("chartInstanceModel",function(){return{chartInstancesInfo:[{id:"1",version:"string",originId:"string",ownerId:"string",authorId:"string",author:"string",name:"string",description:"string",coverImageStore:"string",type:0,blcProductUrl:"string",creatTime:"Date",lastUpdate:"Date",isFrozen:!1,isDeleted:!1,isMyCoverImage:!1,sharing:null}],chartInstanceData:{id:"1",name:"string",createTime:"Date",lastUpdate:"Date",ownerId:"string",authorId:"string",author:"string",originId:"string",themeId:1,description:"string",version:"string",productUrl:"string",coverImageStore:"string",type:0,isFrozen:!1,isDeleted:!1,isMyCoverImage:!1,isSaveAs:!1,isTemp:!1,widget:[{define:{width:"number",height:"number"},resource:{id:null,name:null,version:null,category:null,desc:null,price:null,author:null,thumbnail:"url",codeStore:"url",interactive:3,crosstabAbility:1,dataCrosstab:1,options:[{category:"标题",props:[{title:"content",type:"text",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"margin",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontFamily",type:"checkbox",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontSize",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontWeight",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontColor",type:"color",defaultValue:"xxx",description:"xxx",value:"xxx"}]},{category:"副标题",props:[{title:"content",type:"text",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"margin",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontFamily",type:"checkbox",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontSize",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontWeight",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontColor",type:"color",defaultValue:"xxx",description:"xxx",value:"xxx"}]},{category:"图例",props:[{title:"绑定数据项",type:"text",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"布局",type:"text",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"透明度",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"图例项边距",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"图标形状",type:"list",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"图标宽度",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"图标高度",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"文字宽度",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"文字字号",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"文字字体",type:"list",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"粗斜体",type:"list",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"文字颜色",type:"color",defaultValue:"xxx",description:"xxx",value:"xxx"}]},{category:"提示框",props:[{title:"背景色",type:"color",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"边框宽度",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"边框样式",type:"text",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"圆角半径",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"对齐方式",type:"list",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"文字字号",type:"number",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"文字字体",type:"list",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"粗斜体",type:"list",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"文字颜色",type:"color",defaultValue:"xxx",description:"xxx",value:"xxx"}]},{category:"其它属性",props:[{title:"content",type:"xxx",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"margin",type:"xxx",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontFamily",type:"xxx",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontSize",type:"xxx",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontWeight",type:"xxx",defaultValue:"xxx",description:"xxx",value:"xxx"},{title:"fontColor",type:"xxx",defaultValue:"xxx",description:"xxx",value:"xxx"}]}],userData:[["","Kia","Nissan","Toyota","Honda"],["2008",10,11,12,13],["2009",20,11,14,13],["2010",30,15,12,13]]}}]},convertDataToInfo:function(e){return{id:e.id,version:e.version,originId:e.originId,ownerId:e.ownerId,authorId:e.authorId,author:e.author,name:e.name,description:e.description,coverImageStore:e.coverImageStore,type:e.type,blcProductUrl:e.productUrl,creatTime:e.creatTime,lastUpdate:e.lastUpdate,isFrozen:e.isFrozen,isDeleted:e.isDeletd,isMyCoverImage:e.isMyCoverimage,sharing:e.sharing}}}}).factory("chartInstanceInfoResource",["$resource",function(e){return e(charts_server+"/service/charting/chartInstanceInfo/all",{},{query:{method:"GET",isArray:!1}})}]).factory("chartInstanceDataResource",["$resource",function(e){return e(charts_server+"/service/chartInstance/chartInstanceData/:id",{},{update:{method:"PUT",params:{u:"@u"},isArray:!1}})}]).factory("chartInstanceDataManager",["chartInstanceDataResource","$http","$q","chartInstanceModel","chartInstanceInfoManager","MediaLibraryManager",function(t,n,i,o,e,u){var l=o.chartInstanceData;return{getById:function(e){var x=i.defer();return l.id==e?x.resolve(l):t.get({id:e},function(e,t){if(e.error)x.reject(e.error);else{var r=(l=e.object).widget.resource.userData;l.widget.resource.userData=JSON.parse(r),o.chartInstanceData=l,x.resolve(l)}},function(e,t){x.reject(e)}),x.promise},create:function(){var r=i.defer();return t.save({},function(e,t){e.error?r.reject(e.error):(l=e.object,r.resolve(l))},function(e,t){r.reject(e)}),r.promise},update:function(r,e,x){var a=i.defer();return t.update({u:e},r,function(e,t){e.error?a.reject(e.error):(x?(u.clearRefCount(),r.isMyCoverimage&&r.coverImageStore&&u.increaseRefCount(r.coverImageStore),n({method:"POST",url:charts_server+"/service/charting/resource/book/getlogoimg",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},data:"chartbook_id="+r.id}).then(function(e){var t=angular.copy(e.data.object);t&&u.increaseRefCount(t),u.updateRefCounts()})):u.updateRefCounts(),l=r,o.chartInstanceData=r,e.object?a.resolve(e.object):a.resolve())},function(e,t){a.reject(e)}),a.promise},updateCoverImage:function(e,t){l.id==e&&(l.coverImageStore=t)},delete:function(e){var x=i.defer();return t.delete({id:e},function(e,t){if(e.error)x.reject(e.error);else{var r=e.object;u.clearRefCount(),_.each(r,function(e){e.isMyCoverimage&&e.coverImageStore&&u.decreaseRefCount(e.coverImageStore),n({method:"POST",url:charts_server+"/service/charting/resource/book/getlogoimg",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},data:"chartbook_id="+e.id}).then(function(e){var t=angular.copy(e.data.object);t&&u.decreaseRefCount(t),u.updateRefCounts()})}),x.resolve()}},function(e,t){x.reject(e)}),x.promise}}}]).factory("chartInstanceInfoManager",["chartInstanceInfoResource","favoritesResource","shareBooksInfoResource","$q","chartInstanceModel",function(e,t,r,x,a){var n=a.chartInstancesInfo;return{query:function(){var t=x.defer();return e.query(function(e){e.error?t.reject(e.error):(n=e.object,t.resolve(n))},function(e){t.reject(e)}),t.promise},queryCache:function(){var e=x.defer();return _.find(n,function(e){return"1"==e.id})?e.reject("请求出错"):e.resolve(n),e.promise},update:function(e){var t=a.convertDataToInfo(e),r=_.findIndex(n,function(e){return e.id===t.id});if(-1!=r){var x=n[r].sharing;t.sharing=x,n[r]=t}else n.push(t)},updateCoverImage:function(t,e){_.find(n,function(e){return e.id===t}).coverImageStore=e},delete:function(t){var r=[];_.each(n,function(e){_.contains(t,e.id)||r.push(e)}),n=r}}}]);